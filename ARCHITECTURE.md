# 系统架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        Ontology-Aware Memory System            │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   HTTP Client   │    │   Web Browser   │    │   API Testing   │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          └──────────────────────┼──────────────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │      FastAPI Application   │
                    │  ┌─────────────────────────┐│
                    │  │     API Endpoints       ││
                    │  │  ┌─────────────────────┐││
                    │  │  │ /chat               │││
                    │  │  │ /memory             │││
                    │  │  │ /consolidate        │││
                    │  │  │ /entities           │││
                    │  │  │ /explain (bonus)    │││
                    │  │  └─────────────────────┘││
                    │  └─────────────────────────┘│
                    └─────────────┬─────────────┘
                                  │
                    ┌─────────────▼─────────────┐
                    │      Service Layer         │
                    │  ┌─────────────────────────┐│
                    │  │ Memory Service          ││
                    │  │ Entity Service          ││
                    │  │ Embedding Service       ││
                    │  │ Retrieval Service       ││
                    │  │ LLM Service             ││
                    │  └─────────────────────────┘│
                    └─────────────┬─────────────┘
                                  │
                    ┌─────────────▼─────────────┐
                    │      Data Layer           │
                    │  ┌─────────────────────────┐│
                    │  │   PostgreSQL Database   ││
                    │  │  ┌─────────────────────┐││
                    │  │  │ Domain Schema       │││
                    │  │  │ • customers         │││
                    │  │  │ • sales_orders      │││
                    │  │  │ • work_orders       │││
                    │  │  │ • invoices          │││
                    │  │  │ • payments          │││
                    │  │  │ • tasks             │││
                    │  │  └─────────────────────┘││
                    │  │  ┌─────────────────────┐││
                    │  │  │ Memory Schema       │││
                    │  │  │ • chat_events       │││
                    │  │  │ • entities          │││
                    │  │  │ • memories          │││
                    │  │  │ • memory_summaries  │││
                    │  │  └─────────────────────┘││
                    │  └─────────────────────────┘│
                    └─────────────┬─────────────┘
                                  │
                    ┌─────────────▼─────────────┐
                    │   External Services       │
                    │  ┌─────────────────────────┐│
                    │  │     OpenAI API          ││
                    │  │ • Embeddings           ││
                    │  │ • LLM Completion       ││
                    │  └─────────────────────────┘│
                    └─────────────────────────────┘

数据流:
1. Client → API → Service Layer → Database
2. Service Layer → OpenAI API (embeddings, LLM)
3. Database → Service Layer → API → Client

记忆流程:
1. 用户消息 → 实体识别 → 记忆生成 → 向量存储
2. 新消息 → 记忆检索 → 数据库增强 → LLM生成回复
3. 会话结束 → 记忆整合 → 摘要存储
